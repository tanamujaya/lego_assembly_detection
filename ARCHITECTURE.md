# System Architecture Diagram

```
┌─────────────────────────────────────────────────────────────────────────────────┐
│                    LEGO Assembly Error Detection System                         │
│                           Architecture Overview                                  │
└─────────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────────┐
│                                 INPUT LAYER                                      │
├─────────────────────────────────────────────────────────────────────────────────┤
│                                                                                  │
│  ┌──────────────────────┐          ┌──────────────────────┐                   │
│  │  Render Dataset      │          │  Real Photos         │                   │
│  │  (Training)          │          │  (Few-Shot)          │                   │
│  │                      │          │                      │                   │
│  │  • images/           │          │  • images/           │                   │
│  │  • labels/           │          │  • labels/           │                   │
│  └──────────────────────┘          └──────────────────────┘                   │
│           │                                  │                                  │
│           └──────────────┬───────────────────┘                                 │
│                          │                                                      │
└──────────────────────────┼──────────────────────────────────────────────────────┘
                           │
                           ▼
┌─────────────────────────────────────────────────────────────────────────────────┐
│                          DATA PREPARATION LAYER                                  │
├─────────────────────────────────────────────────────────────────────────────────┤
│                                                                                  │
│  ┌────────────────────────────────────────────────────────────────────────┐   │
│  │                      data_preparation.py                               │   │
│  ├────────────────────────────────────────────────────────────────────────┤   │
│  │                                                                          │   │
│  │  • Dataset Organization                                                 │   │
│  │  • K-Fold Split Generation (K=10)                                       │   │
│  │  • Standard Split (70/15/15)                                            │   │
│  │  • YOLO Format Conversion                                               │   │
│  │  • Few-Shot Data Organization                                           │   │
│  │                                                                          │   │
│  └────────────────────────────────────────────────────────────────────────┘   │
│                                     │                                            │
└─────────────────────────────────────┼────────────────────────────────────────────┘
                                      │
                                      ▼
┌─────────────────────────────────────────────────────────────────────────────────┐
│                            MODEL MANAGEMENT LAYER                                │
├─────────────────────────────────────────────────────────────────────────────────┤
│                                                                                  │
│  ┌────────────────────────────────────────────────────────────────────────┐   │
│  │                       model_manager.py                                 │   │
│  ├────────────────────────────────────────────────────────────────────────┤   │
│  │                                                                          │   │
│  │  ┌──────────────────────────────────────────────────────────────────┐ │   │
│  │  │           BaseDetectionModel (Abstract)                           │ │   │
│  │  │  • load_model()  • train()  • predict()                           │ │   │
│  │  │  • evaluate()    • fine_tune()  • export_model()                  │ │   │
│  │  └──────────────────────────────────────────────────────────────────┘ │   │
│  │                             │                                          │   │
│  │                             ▼                                          │   │
│  │  ┌──────────────────────────────────────────────────────────────────┐ │   │
│  │  │                    YOLOModel                                      │ │   │
│  │  ├──────────────────────────────────────────────────────────────────┤ │   │
│  │  │  • YOLOv8n (nano) - RPi optimized                                │ │   │
│  │  │  • YOLOv8s (small) - RPi compatible                              │ │   │
│  │  │  • YOLOv8m (medium) - GPU only                                   │ │   │
│  │  │  • YOLOv5n (nano) - Alternative                                  │ │   │
│  │  └──────────────────────────────────────────────────────────────────┘ │   │
│  │                                                                          │   │
│  │  ┌──────────────────────────────────────────────────────────────────┐ │   │
│  │  │                  ModelManager                                     │ │   │
│  │  │  • Factory pattern for model instantiation                        │ │   │
│  │  │  • Interchangeable architecture support                           │ │   │
│  │  │  • RPi suitability checking                                       │ │   │
│  │  └──────────────────────────────────────────────────────────────────┘ │   │
│  │                                                                          │   │
│  └────────────────────────────────────────────────────────────────────────┘   │
│                                     │                                            │
└─────────────────────────────────────┼────────────────────────────────────────────┘
                                      │
                                      ▼
┌─────────────────────────────────────────────────────────────────────────────────┐
│                            TRAINING PIPELINE LAYER                               │
├─────────────────────────────────────────────────────────────────────────────────┤
│                                                                                  │
│  ┌────────────────────────────────────────────────────────────────────────┐   │
│  │                    training_pipeline.py                                │   │
│  ├────────────────────────────────────────────────────────────────────────┤   │
│  │                                                                          │   │
│  │  ┌────────────────┐  ┌──────────────────┐  ┌───────────────────────┐ │   │
│  │  │  K-Fold CV     │  │  Standard Split  │  │  Few-Shot Fine-Tune   │ │   │
│  │  │  (10 Folds)    │  │  (70/15/15)      │  │  (Domain Adaptation)  │ │   │
│  │  ├────────────────┤  ├──────────────────┤  ├───────────────────────┤ │   │
│  │  │ • train_kfold()│  │ • train_standard │  │ • few_shot_fine_tune()│ │   │
│  │  │ • Aggregate    │  │   _split()       │  │ • Transfer learning   │ │   │
│  │  │   metrics      │  │ • Single train   │  │ • Low learning rate   │ │   │
│  │  │ • Best fold    │  │   /val/test      │  │ • Small batch size    │ │   │
│  │  │   selection    │  │                  │  │                       │ │   │
│  │  └────────────────┘  └──────────────────┘  └───────────────────────┘ │   │
│  │                                                                          │   │
│  └────────────────────────────────────────────────────────────────────────┘   │
│                                     │                                            │
└─────────────────────────────────────┼────────────────────────────────────────────┘
                                      │
                                      ▼
┌─────────────────────────────────────────────────────────────────────────────────┐
│                          INFERENCE ENGINE LAYER                                  │
├─────────────────────────────────────────────────────────────────────────────────┤
│                                                                                  │
│  ┌────────────────────────────────────────────────────────────────────────┐   │
│  │                        inference.py                                    │   │
│  ├────────────────────────────────────────────────────────────────────────┤   │
│  │                                                                          │   │
│  │  ┌──────────────────────────────────────────────────────────────────┐ │   │
│  │  │            LEGOAssemblyInspector                                  │ │   │
│  │  ├──────────────────────────────────────────────────────────────────┤ │   │
│  │  │  • Raspberry Pi Optimizations:                                   │ │   │
│  │  │    - FP16 (Half Precision)                                       │ │   │
│  │  │    - Multi-threading (4 cores)                                   │ │   │
│  │  │    - Batch processing                                            │ │   │
│  │  │                                                                   │ │   │
│  │  │  • inspect_assembly()    → Single inspection                     │ │   │
│  │  │  • batch_inspect()       → Batch processing                      │ │   │
│  │  │  • visualize_result()    → Result visualization                  │ │   │
│  │  │                                                                   │ │   │
│  │  │  Input:  Order Request + Image                                   │ │   │
│  │  │  Output: Right/Wrong + Assessment Time                           │ │   │
│  │  └──────────────────────────────────────────────────────────────────┘ │   │
│  │                                                                          │   │
│  │  ┌──────────────────────────────────────────────────────────────────┐ │   │
│  │  │            ProductionSimulator                                    │ │   │
│  │  │  • simulate_production_line()                                     │ │   │
│  │  │  • Batch testing                                                  │ │   │
│  │  │  • Performance benchmarking                                       │ │   │
│  │  └──────────────────────────────────────────────────────────────────┘ │   │
│  │                                                                          │   │
│  └────────────────────────────────────────────────────────────────────────┘   │
│                                     │                                            │
└─────────────────────────────────────┼────────────────────────────────────────────┘
                                      │
                                      ▼
┌─────────────────────────────────────────────────────────────────────────────────┐
│                         EVALUATION & METRICS LAYER                               │
├─────────────────────────────────────────────────────────────────────────────────┤
│                                                                                  │
│  ┌────────────────────────────────────────────────────────────────────────┐   │
│  │                       evaluation.py                                    │   │
│  ├────────────────────────────────────────────────────────────────────────┤   │
│  │                                                                          │   │
│  │  ┌──────────────────────────────────────────────────────────────────┐ │   │
│  │  │                  ModelEvaluator                                   │ │   │
│  │  ├──────────────────────────────────────────────────────────────────┤ │   │
│  │  │                                                                   │ │   │
│  │  │  Metrics:                         Visualizations:                │ │   │
│  │  │  • Precision                      • K-fold plots                 │ │   │
│  │  │  • Recall                         • Comparison charts            │ │   │
│  │  │  • mAP@0.5                        • Confusion matrices           │ │   │
│  │  │  • mAP@0.5:0.95                   • Inference time plots         │ │   │
│  │  │  • Per-class metrics              • Performance dashboards       │ │   │
│  │  │                                                                   │ │   │
│  │  │  • plot_kfold_metrics()                                          │ │   │
│  │  │  • plot_metrics_comparison()                                     │ │   │
│  │  │  • create_summary_dashboard()                                    │ │   │
│  │  │  • generate_evaluation_report()                                  │ │   │
│  │  │                                                                   │ │   │
│  │  └──────────────────────────────────────────────────────────────────┘ │   │
│  │                                                                          │   │
│  └────────────────────────────────────────────────────────────────────────┘   │
│                                                                                  │
└─────────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────────┐
│                           INTERFACE LAYERS                                       │
├─────────────────────────────────────────────────────────────────────────────────┤
│                                                                                  │
│  ┌──────────────────────────┐            ┌──────────────────────────┐          │
│  │    CLI Interface         │            │    Python API            │          │
│  │    (main.py)             │            │    (Direct Import)       │          │
│  ├──────────────────────────┤            ├──────────────────────────┤          │
│  │                          │            │                          │          │
│  │  • train                 │            │  from training_pipeline  │          │
│  │  • finetune              │            │    import TrainingPipeline│         │
│  │  • infer                 │            │                          │          │
│  │  • evaluate              │            │  from inference import   │          │
│  │  • compare               │            │    LEGOAssemblyInspector │          │
│  │  • simulate              │            │                          │          │
│  │                          │            │  # Full programmatic     │          │
│  └──────────────────────────┘            │  # control               │          │
│                                           └──────────────────────────┘          │
└─────────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────────┐
│                           UTILITY MODULES                                        │
├─────────────────────────────────────────────────────────────────────────────────┤
│                                                                                  │
│  ┌──────────────────┐  ┌──────────────────┐  ┌──────────────────────────┐     │
│  │  config.py       │  │  utils.py        │  │  examples.py             │     │
│  ├──────────────────┤  ├──────────────────┤  ├──────────────────────────┤     │
│  │ • Configuration  │  │ • DataValidator  │  │ • 10 Usage Examples      │     │
│  │ • Constants      │  │ • SystemTester   │  │ • Interactive Menu       │     │
│  │ • Device setup   │  │ • Data quality   │  │ • Best practices demos   │     │
│  │ • Optimizations  │  │   checking       │  │                          │     │
│  └──────────────────┘  └──────────────────┘  └──────────────────────────┘     │
│                                                                                  │
└─────────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────────┐
│                              OUTPUT LAYER                                        │
├─────────────────────────────────────────────────────────────────────────────────┤
│                                                                                  │
│  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐                │
│  │ Trained Models  │  │ Results & Logs  │  │  Visualizations │                │
│  ├─────────────────┤  ├─────────────────┤  ├─────────────────┤                │
│  │ • best.pt       │  │ • JSON results  │  │ • Metric plots  │                │
│  │ • last.pt       │  │ • Training logs │  │ • Dashboards    │                │
│  │ • onnx/tflite   │  │ • Eval reports  │  │ • Confusion mat │                │
│  └─────────────────┘  └─────────────────┘  └─────────────────┘                │
│                                                                                  │
│  ┌───────────────────────────────────────────────────────────────────────┐     │
│  │                   Inspection Results                                  │     │
│  ├───────────────────────────────────────────────────────────────────────┤     │
│  │  {                                                                     │     │
│  │    "inspection_id": "INS_20250106_143022",                            │     │
│  │    "result": "Right" | "Wrong",                                       │     │
│  │    "assessment_time": 0.687,                                          │     │
│  │    "error_count": 2,                                                  │     │
│  │    "confidence_scores": [0.89, 0.76],                                 │     │
│  │    "detections": [...]                                                │     │
│  │  }                                                                     │     │
│  └───────────────────────────────────────────────────────────────────────┘     │
│                                                                                  │
└─────────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────────┐
│                          DEPLOYMENT TARGET                                       │
├─────────────────────────────────────────────────────────────────────────────────┤
│                                                                                  │
│                         ┌──────────────────────────┐                            │
│                         │   Raspberry Pi 4B        │                            │
│                         ├──────────────────────────┤                            │
│                         │  • 4GB/8GB RAM           │                            │
│                         │  • Quad-core ARM CPU     │                            │
│                         │  • Optimized inference   │                            │
│                         │  • <1s per image         │                            │
│                         │  • FP16 precision        │                            │
│                         │  • Multi-threading       │                            │
│                         └──────────────────────────┘                            │
│                                                                                  │
└─────────────────────────────────────────────────────────────────────────────────┘

═════════════════════════════════════════════════════════════════════════════════
                           DATA FLOW DIAGRAM
═════════════════════════════════════════════════════════════════════════════════

    Training Phase:
    ───────────────
    Render Images → Data Prep → K-Fold Split → Train Model → Evaluate
                                                    ↓
                              Fine-tune ← Real Photos
                                    ↓
                              Best Model → Export


    Inference Phase:
    ────────────────
    Order Request + Image → Inspector → Detection → Result (Right/Wrong)
                                ↓
                          Assessment Time
                                ↓
                          Visualization

═════════════════════════════════════════════════════════════════════════════════
                           KEY FEATURES
═════════════════════════════════════════════════════════════════════════════════

✓ Interchangeable Models      → YOLOv8n/s/m, YOLOv5n (easy to extend)
✓ K-Fold Cross-Validation     → 10-fold with aggregated metrics
✓ Dataset Splits              → 70% train, 15% val, 15% test
✓ Few-Shot Fine-Tuning        → Domain adaptation (renders → real)
✓ Comprehensive Metrics       → Precision, Recall, mAP@0.5, mAP@0.5:0.95
✓ Raspberry Pi Optimization   → FP16, multi-threading, <1s inference
✓ Production Ready            → Order + Image → Right/Wrong + Time
✓ Visualization Suite         → Automated plots and dashboards
✓ Batch Processing            → Efficient multi-image handling
✓ Full Documentation          → README, QuickStart, Examples

═════════════════════════════════════════════════════════════════════════════════
```
